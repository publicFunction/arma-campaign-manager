var application=angular.module("campaignmanager",["ngCookies","ui.router"]);application.config(["$httpProvider",function(t){t.defaults.useXDomain=!0,delete t.defaults.headers.common["X-Requested-With"]}]),application.constant("config",{apiUrl:"http://api.cm.app.dev/v1/",apiVersion:"v1"}),application.run(["$rootScope","$state","$location","AuthService",function(t,e,o,n){var r=["","/","/about","/contact"];t.$on("$stateChangeStart",function(e,a,i,l,c){t.state_path=a.name,t.user={},n.isLoggedIn(function(e){console.debug("Current User is valid : "+e.status+" "+e.statusText),t.authorised=!0,t.user=JSON.parse(localStorage.getItem("user"))},function(t){r.indexOf(a.url)<0&&o.path("/login")})});new function(){var t=this;t.methodForIDE=function(){return"HELLOO!"}}}]),application.config(["$stateProvider","$urlRouterProvider","$sceDelegateProvider",function(t,e,o){e.otherwise("/"),o.resourceUrlWhitelist(["self"]),t.state("home",{url:"/",templateUrl:"/templates/home.html",controller:"DefaultController"}).state("dashboard",{url:"/dashboard",templateUrl:"/templates/dashboard/index.html",controller:"DashboardController"}).state("settings",{url:"/settings",templateUrl:"/templates/settings/index.html",controller:"DashboardController"}).state("about",{url:"/about",templateUrl:"/templates/about/index.html",controller:"DefaultController"}).state("about-maps",{url:"/about/maps",templateUrl:"/templates/about/maps.html",controller:"DefaultController"}).state("contact",{url:"/contact",templateUrl:"/templates/contact.html",controller:"DefaultController"}).state("login",{url:"/login",templateUrl:"/templates/auth/login.html",controller:"AuthController"}).state("logout",{url:"/logout",template:"",controller:"AuthController"})}]),application.controller("AboutController",["$scope","$state",function(t,e){}]),application.controller("AuthController",["$rootScope","$scope","$location","AuthService",function(t,e,o,n){e.account={email:null,password:null},e.email,e.password,e.user={},e.processLogin=function(){e.account.email=this.email,e.account.password=this.password,n.login(e.account,function(){o.path("/dashboard")},function(t){o.path("/login")})},e.processLogout=function(){n.logout(function(e){console.log(e),t.authorised=!1,o.path("/login")},function(t){console.error("Error Processing Logout: "+t.status+" "+t.statusText)})},e.user=function(){n.logout(function(t){e.user=t},function(){o.path("/dashboard")})},e.isAuth=function(){return t.authorised}}]),application.controller("ContactController",["$scope","$state",function(t,e){}]),application.controller("DashboardController",["$rootScope","$scope","DashboardService","CommunityService","ServerQueryService",function(t,e,o,n,r){e.campaign={},e.community={},e.init=function(){},e.init()}]),application.controller("DefaultController",["$scope","$state","$http","$rootScope",function(t,e,o,n){}]),application.directive("currentCampaign",["CampaignService","CommunityService",function(t,e){return{restrict:"A",scope:{community:"=community"},transclude:!0,templateUrl:"templates/partials/current_campaign.html",link:function(e,o,n){e.$watch("community",function(o){t.getLatestCampaign(o,function(t){e.campaign=t},function(t){})})}}}]),application.directive("homeFeatures",function(){var t=this;return reveals=function(t,e){switch(reveal=e.find("div.reveal"),content=reveal.find("div.content"),t.type){case"click":case"mouseenter":reveal.show(),$.each(content,function(){$(this).attr("href")=="#"+t.currentTarget.id&&$(this).fadeIn("500")});break;case"mouseleave":reveal.hide(),content.hide()}},{element:"E",templateUrl:"templates/partials/home_features.html",link:function(e,o,n){articles=o.find("article"),articles.hover(function(e){e.preventDefault(),t.reveals(e,o)}),articles.click(function(e){e.preventDefault(),t.reveals(e,o)})}}}),application.directive("serverStatus",["CommunityService","ServerQueryService",function(t,e){return{element:"E",templateUrl:"templates/partials/server_status.html",link:function(o,n,r){t.getCommunityServers(function(t){o.servers=t.data},function(t){console.error(t)}),o.getServerStatus=function(t){return e.contactServer(t)}}}}]),application.directive("aDirective",function(){return{element:"A",template:'<span class="some-class">This is a directive</span>',link:function(t,e,o){}}}),application.factory("AuthService",["$http","config",function(t,e){return{login:function(o,n,r){t({method:"POST",url:e.apiUrl+"auth",data:o}).then(function(t){console.debug("Login Successful"),localStorage.setItem("token",t.data.token),localStorage.setItem("user",JSON.stringify(t.data.user)),n()},function(t){localStorage.clear(),console.debug("Login Failed"),r()})},logout:function(o,n){t({method:"DELETE",url:e.apiUrl+"auth",headers:{Authorization:"Bearer "+localStorage.getItem("token")}}).then(function(t){console.log("Logout Successful"),localStorage.clear(),o(t)},function(t){console.error("Logout Failed"),401===t.status&&(localStorage.removeItem("token"),console.error(t.status,t.statusText)),n(t)})},me:function(o,n){t({method:"GET",url:e.apiUrl+"auth",headers:{Authorization:"Bearer "+localStorage.getItem("token")}}).then(function(t){console.log("Successful Auth Call"),successResp(t)},function(t){console.log("Error on Auth Call"),n(t)})},getToken:function(){return localStorage.getItem("token")},isLoggedIn:function(o,n){t({method:"GET",url:e.apiUrl+"auth",headers:{Authorization:"Bearer "+localStorage.getItem("token")}}).then(function(t){console.debug("Successful Auth Call"),o(t)},function(t){console.error("Error on Auth Call"),401!==t.status&&400!==t.status||(localStorage.removeItem("token"),console.error(t.status,t.statusText)),n(t)})}}}]),application.factory("CampaignService",["$http","config",function(t,e){return{getLatestCampaign:function(o,n,r){t({method:"GET",url:e.apiUrl+"community",headers:{Authorization:"Bearer "+localStorage.getItem("token")}}).then(function(t){return n({name:"Campaign One"})},function(t){return r(t)})}}}]),application.factory("CommunityService",["$http","config",function(t,e){return{getCommunity:function(o,n){t({method:"GET",url:e.apiUrl+"community",headers:{Authorization:"Bearer "+localStorage.getItem("token")}}).then(function(t){return o(t)},function(t){return n(t)})},getCommunityServers:function(o,n){t({method:"GET",url:e.apiUrl+"community/servers",headers:{Authorization:"Bearer "+localStorage.getItem("token")}}).then(function(t){return o(t)},function(t){return n(t)})},getCommunityServer:function(o,n,r){console.log("CALLED COMMUNITY Server SERVICE"),t({method:"GET",url:e.apiUrl+"community/servers/"+o,headers:{Authorization:"Bearer "+localStorage.getItem("token")}}).then(function(t){return n(t)},function(t){return r(t)})}}}]),application.factory("DashboardService",["$http","config",function(t,e){return{}}]),application.factory("ServerQueryService",["$http","config",function(t,e){return{contactServer:function(t){console.debug("Connecting to server: "+t.name+"..."),connection=new WebSocket("wss://"+t.ip_address+":"+t.query_port),connection.onerror=function(t){console.error(t)},connection.onopen=function(t){console.log(t),connection.send("Ping")},connection.onmessage=function(t){console.log(t.data)}}}}]);